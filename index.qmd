---
title: "Proyecto Final"
author: "Pablo Palacios DÃ­az - C35849"
format: dashboard
server: shiny
---

```{r}
#| context: setup

library(shiny)
library(rsconnect)
library(ggplot2)
library(tidyverse)
library(plotly)
library(DT)
library(sf)
library(leaflet)
library(leaflet.extras)
library(leafem)
```

```{r}
#| context: data


Areas <-
  st_read(
    dsn = "areas-conservacion.gpkg",
    options = c(
      "X_POSSIBLE_NAMES=decimalLongitude",
      "Y_POSSIBLE_NAMES=decimalLatitude"
    ),
    quiet = TRUE
  )



Especies <-
  st_read(
    dsn = "especies-anfibios.csv",
    options = c(
      "X_POSSIBLE_NAMES=decimalLongitude",
      "Y_POSSIBLE_NAMES=decimalLatitude"
    ),
    quiet = TRUE
  )



RegistrosB <-
  st_read(
    dsn = "registros-bufonidae.csv",
    options = c(
      "X_POSSIBLE_NAMES=decimalLongitude",
      "Y_POSSIBLE_NAMES=decimalLatitude"
    ),
    quiet = TRUE
  )


```



#  {.sidebar}

```{r}
#| panel: sidebar
lista_especies <- unique(RegistrosB$species)
lista_especies <- sort(lista_especies)
lista_especies <- c("Todas", lista_especies)

selectInput(
  inputId = "especie",      
  label = "Especie",
  choices = lista_especies, 
  selected = "Todas"        
)

```

# Data

```{r}
dataTableOutput(
	outputId =  "tabla"
)
```

```{r}
#| label: servidor
#| context: server


filtrar_felidos <- reactive({
  
  felidos_filtrados <- RegistrosB
  
  
  if (input$especie != "Todas") {
    felidos_filtrados <-
      felidos_filtrados |>
      filter(species == input$especie)
  }

  return(felidos_filtrados)
}) 


output$tabla <- renderDataTable({
	
  RegistrosB <- filtrar_felidos()
  
 
  RegistrosB |>
    st_drop_geometry() |>
    select(species) |>
    datatable(
    	rownames = FALSE,
      colnames = c("Especie"),
      options = list(
      	pageLength = 10,
        language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json')
      )
    )
})
```
